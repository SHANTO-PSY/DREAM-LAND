<!doctype html>
<html lang="bn">

<head>
  <meta charset="utf-8" />
  <title>рж╕рзНржмржкрзНржи ржирзАрзЬ рж╕рзЛрж╕рж╛ржЗржЯрж┐ тАФ Welcome тЖТ Rules тЖТ Loan Rules тЖТ Login тЖТ Info</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- libraries -->
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
    :root {
      --bg: #163754;
      --card: #0f2a41;
      --accent: #4CAF50;
      --muted: #9ad6ff;
    }

    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      background: var(--bg);
      color: #fff;
      min-height: 100vh;
      display: grid;
      place-items: center;
      font-family: system-ui, "Segoe UI", Arial, sans-serif;
    }

    .card {
      width: 560px;
      max-width: 94vw;
      background: var(--card);
      border: 1px solid #184261;
      padding: 22px;
      border-radius: 16px;
      box-shadow: 0 14px 40px rgba(0, 0, 0, .25);
    }

    h1,
    h2 {
      margin: 0 0 12px;
      text-align: center;
    }

    p {
      margin: 0 0 10px;
    }

    .hidden {
      display: none !important;
    }

    .logo {
      width: 150px;
      height: 150px;
      object-fit: contain;
      display: block;
      margin: 0 auto 14px;
    }

    .grid-btn {
      display: grid;
      gap: 12px;
      margin: 18px 0;
    }

    button {
      width: 100%;
      padding: 12px;
      border: 0;
      border-radius: 10px;
      color: #fff;
      font-size: 16px;
      cursor: pointer;
      font-weight: 600;
    }

    button:hover {
      filter: brightness(.95);
    }

    button:disabled {
      opacity: .6;
      cursor: not-allowed;
    }

    .btn-member {
      background: #4CAF50;
    }

    .btn-loan {
      background: #2196F3;
    }

    .btn-login {
      background: #FF9800;
    }

    .btn-committee {
      background: #9C27B0;
    }

    .btn-pdf {
      background: #f44336;
    }

    a {
      color: var(--muted);
      text-decoration: none;
    }

    label {
      display: block;
      margin: 8px 0 4px;
      color: #cfeaff;
    }

    input {
      width: 100%;
      height: 44px;
      line-height: 44px;
      padding: 0 14px;
      border-radius: 8px;
      border: 1px solid #2b5576;
      background: #0b2336;
      color: #eef;
    }

    .msg {
      min-height: 1.2em;
      margin: 10px 0;
      font-weight: 700;
    }

    .ok {
      color: #4ad97f
    }

    .err {
      color: #ff6b6b
    }

    .grid {
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 8px 10px;
      margin-top: 10px;
      color: #cde8ff;
    }

    .row {
      position: relative;
    }

    .row input {
      padding-right: 46px;
    }

    .eye {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      width: 28px;
      height: 28px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      background: transparent;
      border: 0;
      color: #bcd;
      cursor: pointer;
    }

    .link {
      color: #9ad6ff;
      cursor: pointer;
      text-align: center;
      display: block;
      margin-top: 10px;
    }

    .article {
      margin-top: 16px;
      text-align: left;
      line-height: 1.6;
      color: #dff1ff;
    }

    .result-box {
      margin-top: 12px;
      padding: 12px;
      background: #071a2a;
      border-radius: 8px;
      border: 1px solid #1f445d;
    }

    .notice {
      background: #fff3cd;
      color: #533f03;
      border: 1px solid #ffecb5;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: 0 6px 18px rgba(0, 0, 0, .15);
      margin-bottom: 12px;
      color: #533f03;
    }

    .notice h3 {
      margin: 0 0 8px;
      font-size: 18px;
      text-align: left;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    footer {
      margin-top: 12px;
      text-align: center;
      color: #cfeaff;
      font-size: 13px;
    }

    /* Member card inside result (visual) */
    #memberCard {
      background: linear-gradient(180deg, rgba(255, 255, 255, 0.04), rgba(255, 255, 255, 0.02));
      border-radius: 12px;
      padding: 14px;
      position: relative;
      overflow: hidden;
      color: #eaf6ff;
    }

    /* watermark (uses local logo.png path) */
    #memberCard::before {
      content: "";
      position: absolute;
      inset: 0;
      background-image: url('./logo.png');
      background-repeat: no-repeat;
      background-position: center;
      background-size: 260px;
      opacity: 0.06;
      pointer-events: none;
    }

    .mc-top {
      display: flex;
      gap: 12px;
      align-items: center;
      z-index: 1;
      position: relative;
    }

    .mc-top img {
      width: 72px;
      height: 72px;
      object-fit: contain;
      border-radius: 10px;
      background: #fff;
      padding: 6px;
    }

    .mc-title {
      flex: 1;
      text-align: center;
      color: #fff;
      line-height: 1.1;
      font-weight: 700;
      font-size: 16px;
    }

    .mc-fields {
      margin-top: 12px;
      z-index: 1;
      position: relative;
    }

    .mc-row {
      display: flex;
      justify-content: space-between;
      padding: 6px 4px;
      border-bottom: 1px dashed rgba(255, 255, 255, 0.04);
      color: #dff1ff;
    }

    .mc-footer {
      margin-top: 8px;
      text-align: center;
      font-size: 12px;
      color: #c9e7ff;
      z-index: 1;
      position: relative;
    }

    /* small helper (contact) */
    .help {
      margin-top: 10px;
      font-size: 13px;
      color: #cfeaff;
      text-align: center;
    }
  </style>
</head>

<body>

  <!-- WELCOME -->
  <div id="welcome" class="card">
    <img class="logo" src="./logo.png" onerror="this.onerror=null;this.src='https://drive.google.com/uc?export=view&id=1EGbLTY58jMndZr54waGm7RjeqcX5SYsP';" alt="Logo">
    <h1>рж╕рзНржмрж╛ржЧрждржо!</h1>
    <p class="article">тАЬрж╕рзНржмржкрзНржи ржирзАрзЬ рж╕рзЛрж╕рж╛ржЗржЯрж┐тАЭ-рждрзЗ ржЖржкржирж╛ржХрзЗ ржЖржирзНрждрж░рж┐ржХ рж╕рзНржмрж╛ржЧрждржо ЁЯМ╕</p>

    <div class="grid-btn">
      <button id="showRules" class="btn-member">ЁЯУе ржбрж╛ржЙржирж▓рзЛржб рж╕ржжрж╕рзНржп ржЖржмрзЗржжржи ржлрж░рзНржо</button>
      <button id="showLoanRules" class="btn-loan">ЁЯУе ржЛржг ржкрзНрж░ржжрж╛ржирзЗрж░ ржирж┐рзЯржорж╛ржмрж▓рзА</button>
      <a href="#" style="text-decoration:none"><button id="goLogin" class="btn-login">ЁЯФС рж╕ржжрж╕рзНржп рж▓ржЧ ржЗржи</button></a>
      <button id="goCommittees" class="btn-committee">ЁЯСе ржЖржорж╛ржжрзЗрж░ ржХржорж┐ржЯрж┐</button>
    </div>

    <div class="article">
      <h2>ЁЯУ░ рж╕рж╛ржорзНржкрзНрж░рждрж┐ржХ ржЖрж░рзНржЯрж┐ржХрзЗрж▓</h2>
      <p>ЁЯСЙ ржЖржорж╛ржжрзЗрж░ рж╕ржорж╛ржЬ ржЙржирзНржирзЯржирзЗрж░ ржЬржирзНржп ржмрж┐ржнрж┐ржирзНржи ржХрж░рзНржорж╕рзВржЪрж┐ ржЪрж▓ржЫрзЗред</p>
      <p>ЁЯСЙ ржЛржг ржкрзНрж░ржжрж╛ржирзЗрж░ ржирж┐рзЯржорж╛ржмрж▓рзА рж╢рзАржШрзНрж░ржЗ ржЖржкржбрзЗржЯ ржХрж░рж╛ рж╣ржмрзЗред</p>
      <p>ЁЯСЙ ржирждрзБржи рж╕ржжрж╕рзНржп рж╕ржВржЧрзНрж░рж╣ ржЕржнрж┐ржпрж╛ржи рж╢рзБрж░рзБ рж╣рзЯрзЗржЫрзЗред</p>
    </div>

    <div class="help">Help: <a href="mailto:saiful.shanto1122@gmail.com">saiful.shanto1122@gmail.com</a> | WhatsApp: <a href="https://wa.me/8801633346080" target="_blank">01633346080</a></div>
  </div>

  <!-- RULES -->
  <div id="rules" class="card hidden">
    <h2>ЁЯУЬ рж╕ржжрж╕рзНржп ржЖржмрзЗржжржи ржирж┐рзЯржорж╛ржмрж▓рзА</h2>
    <div class="notice">
      <h3>ржжрзЯрж╛ ржХрж░рзЗ ржирж┐ржЪрзЗрж░ ржирж┐рзЯржоржЧрзБрж▓рзЛ ржнрж╛рж▓рзЛ ржХрж░рзЗ ржкрзЬрзБржи</h3>
      <ul>
        <li>рж╢рзЗрзЯрж╛рж░рж╣рзЛрж▓рзНржбрж╛рж░ ржПрж░ рзи ржХржкрж┐ ржЫржмрж┐, ржПржиржЖржЗржбрж┐ рзз ржХржкрж┐ ржПржмржВ ржиржорж┐ржирж┐ рзз ржХржкрж┐ ржЫржмрж┐, ржПржиржЖржЗржбрж┐ рзз ржХржкрж┐ ржУ рзирзжрзж ржЯрж╛ржХрж╛ ржЬржорж╛ ржжрж┐рзЯрзЗ ржлрж░ржо ржлрж┐рж▓рж╛ржк ржХрж░рзЗ ржЬржорж╛ ржжрж┐рждрзЗ рж╣ржмрзЗред</li>
        <li>ржкрзНрж░рждрж┐ ржорж╛рж╕рзЗрж░ рззрзл рждрж╛рж░рж┐ржЦрзЗрж░ ржоржзрзНржпрзЗ рж╕рж╛ржмрж╕рзНржХрзНрж░рж┐ржкрж╢ржи ржлрж┐ рж╕ржВржЧрзНрж░рж╣ ржХрж░рж╛ рж╣ржмрзЗ; ржкрзНрж░ржжрж╛ржи ржирж╛ ржХрж░рж▓рзЗ рзлрзжрзж ржЯрж╛ржХрж╛ ржЬрж░рж┐ржорж╛ржирж╛ ржХрж░рж╛ рж╣ржмрзЗред</li>
        <li>ржХрзЛржирзЛ рж╕ржжрж╕рзНржп ржкрж░ржкрж░ рждрж┐ржи ржорж╛рж╕рзЗрж░ ржХрж┐рж╕рзНрждрж┐ ржжрж┐рждрзЗ ржмрзНржпрж░рзНрже рж╣рж▓рзЗ рж╕ржВржЧржаржи ржерзЗржХрзЗ ржмрж╛ржЫрж╛ржЗ/ржирж┐рж╖рзНржкрждрзНрждрж┐ ржХрж░рж╛ рж╣рждрзЗ ржкрж╛рж░рзЗред</li>
        <li>рж╢рзЗрзЯрж╛рж░ ржмрж╛рждрж┐рж▓ ржХрж░рждрзЗ рж╣рж▓рзЗ ржкрзНрж░ржХрж▓рзНржкрзЗрж░ рж╕ржнрж╛ржкрждрж┐рж░ ржмрж░рж╛ржмрж░ рзй ржорж╛рж╕ ржкрзВрж░рзНржмрзЗ рж▓рж┐ржЦрж┐рждржнрж╛ржмрзЗ ржЬрж╛ржирждрзЗ рж╣ржмрзЗред</li>
        <li>рж╕ржжрж╕рзНржпрждрж╛рж░ ржмрж╛рждрж┐рж▓рзЗрж░ рж╕ржорзЯрзЗ ржорзЛржЯ ржЖржжрж╛рзЯржХрзГржд ржЕрж░рзНрже ржерзЗржХрзЗ рзл% ржЪрж╛рж░рзНржЬ ржХрж╛ржЯрж╛ рж╣ржмрзЗред</li>
        <li>рзл ржмржЫрж░рзЗрж░ ржмрзЗрж╢рж┐ ржорзЗрзЯрж╛ржжрзЗ рж╕ржВржЧржаржи ржерзЗржХрзЗ ржмрзЗрж░ рж╣рж▓рзЗ ржХрзЛржирзЛ ржЗржирзНржЯрж╛рж░рзЗрж╕рзНржЯ ржкрзНрж░ржжрж╛ржи ржХрж░рж╛ рж╣ржмрзЗ ржирж╛ред</li>
      </ul>
    </div>
    <a href="forms/member_form.pdf" target="_blank"><button class="btn-member">тмЗя╕П ржлрж░рзНржо ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи</button></a>
    <span class="link" id="backHomeRules">тЖР рж╣рзЛржорзЗ ржлрж┐рж░рзБржи</span>
    <div class="help">Contact: <a href="mailto:saiful.shanto1122@gmail.com">saiful.shanto1122@gmail.com</a> | WhatsApp: <a href="https://wa.me/8801633346080" target="_blank">01633346080</a></div>
  </div>

  <!-- LOAN RULES -->
  <div id="loanRules" class="card hidden">
    <h2>ЁЯТ░ ржЛржг ржкрзНрж░ржжрж╛ржирзЗрж░ ржирж┐рзЯржорж╛ржмрж▓рзА</h2>
    <div class="notice">
      <ul>
        <li>рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕ржХрзНрж░рж┐рзЯ рж╕ржжрж╕рзНржпрж░рж╛ржЗ ржЛржг ржЖржмрзЗржжржи ржХрж░рждрзЗ ржкрж╛рж░ржмрзЗржиред</li>
        <li>ржЛржг ржЧрзНрж░рж╣ржгрзЗрж░ ржЬржирзНржп ржХржоржкржХрзНрж╖рзЗ рзм ржорж╛рж╕рзЗрж░ рж╕ржжрж╕рзНржпржкржж ржерж╛ржХрждрзЗ рж╣ржмрзЗред</li>
        <li>ржЖржкржирж┐ ржЖржкржирж╛рж░ ржЬржорж╛ржХрзГржд ржЯрж╛ржХрж╛рж░ ржорзЛржЯ рзнрзж% ржкрж░рзНржпржирзНржд ржЛржг ржирж┐рждрзЗ ржкрж╛рж░ржмрзЗржи (ржкрзНрж░ржХрж╛рж╢рж┐ржд ржирж┐рзЯржо ржЕржирзБрж╕рж╛рж░рзЗ)ред</li>
        <li>ржЛржг ржЧрзНрж░рж╣ржгрзЗрж░ рззрзл ржжрж┐ржи ржЖржЧрзЗ ржЬрж╛ржирж╛рждрзЗ рж╣ржмрзЗред</li>
        <li>ржЛржг ржкрж░рж┐рж╢рзЛржз ржирж╛ ржХрж░рж▓рзЗ рж╕ржВржЧржаржирзЗрж░ рж╕рж┐ржжрзНржзрж╛ржирзНржд ржЕржирзБржпрж╛рзЯрзА ржЖржЗржиржЧржд ржмрзНржпржмрж╕рзНржерж╛ ржирзЗржУрзЯрж╛ рж╣ржмрзЗред</li>
        <li>ржХрж┐рж╕рзНрждрж┐ ржорж┐рж╕ ржХрж░рж▓рзЗ ржЕрждрж┐рж░рж┐ржХрзНржд ржЬрж░рж┐ржорж╛ржирж╛/рж╢рж╛рж╕рзНрждрж┐ ржкрзНрж░ржпрзЛржЬрзНржп рж╣ржмрзЗред</li>
      </ul>
    </div>
    <a href="forms/loan_form.pdf" target="_blank"><button class="btn-loan">тмЗя╕П ржЛржг ржлрж░рзНржо ржбрж╛ржЙржирж▓рзЛржб ржХрж░рзБржи</button></a>
    <span class="link" id="backHomeLoanRules">тЖР рж╣рзЛржорзЗ ржлрж┐рж░рзБржи</span>
    <div class="help">Contact: <a href="mailto:saiful.shanto1122@gmail.com">saiful.shanto1122@gmail.com</a> | WhatsApp: <a href="https://wa.me/8801633346080" target="_blank">01633346080</a></div>
  </div>

  <!-- LOGIN -->
  <div id="login" class="card hidden">
    <h2>рж▓ржЧржЗржи (CODE + PASS)</h2>
    <label>CODE</label>
    <input id="code" placeholder="User ID">
    <label>PASS</label>
    <div class="row">
      <input id="pass" type="password" placeholder="Password" aria-label="Password">
      <button class="eye" id="togglePass" aria-label="Show/Hide">ЁЯСБ</button>
    </div>
    <button id="loginBtn" class="btn-login">рж▓ржЧржЗржи</button>
    <div id="msg" class="msg"></div>
    <span class="link" id="backHome1">тЖР рж╣рзЛржорзЗ ржлрж┐рж░рзБржи</span>
    <div class="help">Help: <a href="mailto:saiful.shanto1122@gmail.com">saiful.shanto1122@gmail.com</a> | WhatsApp: <a href="https://wa.me/8801633346080" target="_blank">01633346080</a></div>
  </div>

  <!-- SUCCESS ANIM -->
  <div id="successAnim" class="card hidden">
    <div class="anim-box" style="text-align:center; margin-bottom:8px;">
      <div class="circle" style="width:120px;height:120px;border-radius:50%;background:#4CAF50;display:flex;align-items:center;justify-content:center;margin:0 auto;">
        <div class="check" style="width:40px;height:20px;border-left:5px solid #fff;border-bottom:5px solid #fff;transform:rotate(-45deg);"></div>
      </div>
    </div>
    <div id="welcomeName" style="font-weight:700; text-align:center;"></div>
  </div>

  <!-- RESULT (member card visual) -->
  <div id="result" class="card hidden">
    <h2>ржЖржкржирж╛рж░ рждржерзНржп</h2>

    <div id="memberCard">
      <div class="mc-top">
        <img src="./logo.png" onerror="this.onerror=null;this.src='https://drive.google.com/uc?export=view&id=1EGbLTY58jMndZr54waGm7RjeqcX5SYsP';" alt="Logo" class="mc-logo">
        <div class="mc-title">
          <div style="font-size:16px;font-weight:800;">рж╕рзНржмржкрзНржи ржирзАрзЬ рж╕рзЛрж╕рж╛ржЗржЯрж┐</div>
          <div style="font-size:13px;font-weight:600;opacity:0.95;">ржорзЗржорзНржмрж╛рж░ ржХрж╛рж░рзНржб</div>
        </div>
      </div>

      <div class="mc-fields">
        <div class="mc-row">
          <div>ржХрзЛржб</div>
          <div id="v_code"></div>
        </div>
        <div class="mc-row">
          <div>ржирж╛ржо</div>
          <div id="v_name"></div>
        </div>
        <div class="mc-row">
          <div>ржПржиржЖржЗржбрж┐</div>
          <div id="v_nid"></div>
        </div>
        <div class="mc-row">
          <div>ржлрзЛржи</div>
          <div id="v_phone"></div>
        </div>
        <div class="mc-row">
          <div>ржХрж┐рж╕рзНрждрж┐</div>
          <div id="v_inst"></div>
        </div>
        <div class="mc-row">
          <div>ржорзЛржЯ ржкрзНрж░ржжрж╛ржи</div>
          <div id="v_pay"></div>
        </div>
      </div>

      <div class="mc-footer" id="issuedAt">ржЗрж╕рзНржпрзБ ржХрж░рж╛: </div>
    </div>

    <button id="downloadPdf" class="btn-pdf" style="margin-top:12px">ЁЯУД ржбрж╛ржЙржирж▓рзЛржб ржорзЗржорзНржмрж╛рж░ ржХрж╛рж░рзНржб (PDF)</button>
    <button id="logout" class="btn-login" style="margin-top:12px">рж▓ржЧржЖржЙржЯ</button>
    <span class="link" id="backHome2">тЖР рж╣рзЛржорзЗ ржлрж┐рж░рзБржи</span>

    <div class="help">Contact: <a href="mailto:saiful.shanto1122@gmail.com">saiful.shanto1122@gmail.com</a> | WhatsApp: <a href="https://wa.me/8801633346080" target="_blank">01633346080</a></div>
  </div>

  <!-- COMMITTEES -->
  <div id="committees" class="card hidden">
    <h2>ржЖржорж╛ржжрзЗрж░ ржХржорж┐ржЯрж┐</h2>
    <ul>
      <li>рж╕ржнрж╛ржкрждрж┐: ржЬржирж╛ржм ржЕржорзБржХ</li>
      <li>рж╕рж╛ржзрж╛рж░ржг рж╕ржорзНржкрж╛ржжржХ: ржЬржирж╛ржм рждржорзБржХ</li>
      <li>ржХрзЛрж╖рж╛ржзрзНржпржХрзНрж╖: ржЬржирж╛ржм XYZ</li>
    </ul>
    <span class="link" id="backHome3">тЖР рж╣рзЛржорзЗ ржлрж┐рж░рзБржи</span>
    <div class="help">Contact: <a href="mailto:saiful.shanto1122@gmail.com">saiful.shanto1122@gmail.com</a> | WhatsApp: <a href="https://wa.me/8801633346080" target="_blank">01633346080</a></div>
  </div>

  <footer style="position:fixed; left:0; right:0; bottom:8px; text-align:center; color:#cfeaff; font-size:13px;">
    ┬й рж╕рзНржмржкрзНржи ржирзАрзЬ рж╕рзЛрж╕рж╛ржЗржЯрж┐ тАФ Help: <a href="mailto:saiful.shanto1122@gmail.com">saiful.shanto1122@gmail.com</a> | WhatsApp: <a href="https://wa.me/8801633346080" target="_blank">01633346080</a>
  </footer>

  <script>
    // Firebase config (existing)
    const firebaseConfig = {
      apiKey: "AIzaSyApZH0la4dyXRJ1rSJVBlusIrLhmAIehLk",
      authDomain: "dream-land-e55e0.firebaseapp.com",
      databaseURL: "https://dream-land-e55e0-default-rtdb.firebaseio.com",
      projectId: "dream-land-e55e0",
      storageBucket: "dream-land-e55e0.firebasestorage.app",
      messagingSenderId: "544133561119",
      appId: "1:544133561119:web:2a30b38a7b1d9f93cfce2a"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    // Helpers (IDs kept same as your previous code)
    const $ = id => document.getElementById(id);
    const show = id => $(id).classList.remove('hidden');
    const hide = id => $(id).classList.add('hidden');
    // Navigation handlers (IDs unchanged)
    $("showRules").onclick = () => {
      hide("welcome");
      show("rules");
    };
    $("backHomeRules").onclick = () => {
      hide("rules");
      show("welcome");
    };
    $("showLoanRules").onclick = () => {
      hide("welcome");
      show("loanRules");
    };
    $("backHomeLoanRules").onclick = () => {
      hide("loanRules");
      show("welcome");
    };
    $("goLogin").onclick = () => {
      hide("welcome");
      show("login");
    };
    $("goCommittees").onclick = () => {
      hide("welcome");
      show("committees");
    };
    $("backHome1").onclick = () => {
      hide("login");
      show("welcome");
    };
    $("backHome2").onclick = () => {
      hide("result");
      show("welcome");
    };
    $("backHome3").onclick = () => {
      hide("committees");
      show("welcome");
    };
    // toggle pass
    $("togglePass").onclick = () => {
      const p = $("pass");
      if (p.type === "password") {
        p.type = "text";
        $("togglePass").textContent = "ЁЯЩИ";
      } else {
        p.type = "password";
        $("togglePass").textContent = "ЁЯСБ";
      }
    };
    // render function (IDs same)
    function renderRow(row) {
      $("v_code").textContent = row["1_ CODE"] ?? "";
      $("v_name").textContent = row["2_ NAME"] ?? "";
      $("v_nid").textContent = row["3_ NID NO"] ?? "";
      $("v_phone").textContent = row["4_ PHONE"] ?? "";
      $("v_inst").textContent = row["5_ INSTALMENT"] ?? "";
      $("v_pay").textContent = row["6_TOTAL PAY"] ?? "";
      // issued date
      $("issuedAt").textContent = "ржЗрж╕рзНржпрзБ ржХрж░рж╛: " + (new Date()).toLocaleString('bn-BD');
    }

    function say(t, ok = false) {
      $("msg").textContent = t;
      $("msg").className = "msg " + (ok ? "ok" : "err");
    }
    // LOGIN (logic unchanged тАФ same DB path & PASS field)
    async function doLogin() {
      say("");
      hide("result");
      const code = $("code").value.trim();
      const pass = $("pass").value.trim();
      if (!code || !pass) {
        say("CODE ржПржмржВ PASS рж▓рж┐ржЦрзБржи");
        return;
      }
      $("loginBtn").disabled = true;
      try {
        const snap = await db.ref("friends/" + code).once("value");
        if (!snap.exists()) {
          say("ржнрзБрж▓ ID тЭМ");
          return;
        }
        const row = snap.val();
        const dbPass = (row && row["7_ PASS"] != null) ? row["7_ PASS"].toString().trim() : "";
        if (dbPass === pass) {
          say("рж▓ржЧржЗржи рж╕ржлрж▓ тЬЕ", true);
          renderRow(row);
          hide("login");
          show("successAnim");
          $("welcomeName").textContent = "рж╕рзНржмрж╛ржЧрждржо, " + (row["2_ NAME"] ?? "");
          setTimeout(() => {
            hide("successAnim");
            show("result");
          }, 1400);
        } else {
          say("ржнрзБрж▓ ржкрж╛рж╕ржУрзЯрж╛рж░рзНржб тЭМ");
        }
      } catch (err) {
        console.error(err);
        say("Firebase Error: " + (err.message || err));
      } finally {
        $("loginBtn").disabled = false;
      }
    }
    $("loginBtn").onclick = doLogin;
    $("pass").addEventListener("keydown", e => {
      if (e.key === "Enter") doLogin();
    });
    $("code").addEventListener("keydown", e => {
      if (e.key === "Enter") doLogin();
    });
    $("logout").onclick = () => {
      hide("result");
      show("login");
    };
    // DOWNLOAD PDF (tries html2canvas first; if it fails, fallback to programmatic jsPDF canvas)
    $("downloadPdf").onclick = async () => {
      const {
        jsPDF
      } = window.jspdf;
      const cardEl = document.getElementById("memberCard");
      // try html2canvas capture (best visual fidelity)
      try {
        const canvas = await html2canvas(cardEl, {
          scale: 2,
          useCORS: true,
          allowTaint: false,
          backgroundColor: '#ffffff'
        });
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jsPDF({
          unit: 'mm',
          format: 'a4'
        });
        const pageWidth = pdf.internal.pageSize.getWidth();
        const imgProps = pdf.getImageProperties(imgData);
        const pdfHeight = (imgProps.height * pageWidth) / imgProps.width;
        // put image at top with small margin
        pdf.addImage(imgData, 'PNG', 0, 10, pageWidth, pdfHeight);
        pdf.save("member_card.pdf");
        return;
      } catch (err) {
        console.warn("html2canvas failed (CORS/taint?). Fallback to generated PDF. Error:", err);
      }
      // fallback: draw simple card with canvas + jsPDF (ensures PDF created even if images tainted)
      try {
        const w = 800,
          h = 480;
        const c = document.createElement('canvas');
        c.width = w;
        c.height = h;
        const ctx = c.getContext('2d');
        // background
        ctx.fillStyle = '#ffffff';
        ctx.fillRect(0, 0, w, h);
        // header bar
        ctx.fillStyle = '#163754';
        ctx.fillRect(0, 0, w, 80);
        // simple logo circle
        ctx.fillStyle = '#FFB74D';
        ctx.beginPath();
        ctx.arc(60, 40, 30, 0, Math.PI * 2);
        ctx.fill();
        ctx.fillStyle = '#063046';
        ctx.font = 'bold 28px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('DL', 60, 46);
        // header texts
        ctx.fillStyle = '#fff';
        ctx.font = 'bold 22px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('рж╕рзНржмржкрзНржи ржирзАрзЬ рж╕рзЛрж╕рж╛ржЗржЯрж┐', w / 2, 45);
        ctx.fillStyle = '#000';
        ctx.font = '16px sans-serif';
        ctx.textAlign = 'left';
        // fields (read from DOM)
        const fields = [
          ['ржХрзЛржб: ', $("v_code").textContent || '-'],
          ['ржирж╛ржо: ', $("v_name").textContent || '-'],
          ['ржПржиржЖржЗржбрж┐: ', $("v_nid").textContent || '-'],
          ['ржлрзЛржи: ', $("v_phone").textContent || '-'],
          ['ржХрж┐рж╕рзНрждрж┐: ', $("v_inst").textContent || '-'],
          ['ржорзЛржЯ ржкрзНрж░ржжрж╛ржи: ', $("v_pay").textContent || '-']
        ];
        let y = 120;
        ctx.fillStyle = '#111';
        for (let i = 0; i < fields.length; i++) {
          ctx.font = '16px sans-serif';
          ctx.fillText(fields[i][0] + fields[i][1], 40, y);
          y += 36;
        }
        // issue date
        ctx.fillStyle = '#444';
        ctx.font = '13px sans-serif';
        ctx.textAlign = 'center';
        ctx.fillText('ржЗрж╕рзНржпрзБ ржХрж░рж╛: ' + (new Date()).toLocaleString(), w / 2, h - 30);
        const imgFallback = c.toDataURL('image/png');
        const pdf = new jsPDF({
          unit: 'mm',
          format: 'a4'
        });
        const pageWidth = pdf.internal.pageSize.getWidth();
        const imgProps = pdf.getImageProperties(imgFallback);
        const pdfHeight = (imgProps.height * pageWidth) / imgProps.width;
        pdf.addImage(imgFallback, 'PNG', 0, 20, pageWidth, pdfHeight);
        pdf.save("member_card.pdf");
      } catch (e) {
        console.error("Fallback PDF creation failed:", e);
        alert("PDF рждрзИрж░рж┐ ржХрж░рждрзЗ рж╕ржорж╕рзНржпрж╛ рж╣рзЯрзЗржЫрзЗ: " + (e.message || e));
      }
    };
  </script>
</body>

</html>
